masonry-wp-lazy-load
====================
<p>I spent&nbsp;copious&nbsp;hours googling for a way to implement <a href="http://www.appelsiini.net/projects/lazyload" target="_blank">lazy load</a> with a gallery generated by <a href="http://www.advancedcustomfields.com/resources/field-types/gallery/" target="_blank">Advanced Custom Fields</a> that was using <a href="http://masonry.desandro.com/demos/images.html" target="_blank">Masonry</a>&nbsp;(this is on Wordpress) to no avail.</p>
<p>I found lots of info on how to integrate infinite scroll, but this was only for a list of posts (the posts are ajaxed in from the "next" page of posts), but nothing about doing this with just a gallery of images.</p>
<p><em>And then my amazing co-worker had a solution.</em></p>
<p><a href="http://www.appelsiini.net/projects/lazyload" target="_blank">Lazy load</a> works by having a placeholder image until the time that the actual image is needed. &nbsp;The image url is stored in a data attribute in the image tag.</p>
<p><a href="http://masonry.desandro.com/demos/images.html" target="_blank">Masonry</a> lays out the page after <strong>all</strong> of the images have been loaded - and doesn't fire again after that.</p>
<p><strong>So if you are using a generic placeholder graphic that is always the same size... how will masonry know how to lay out the images properly as they appear on scroll??</strong></p>
<p>The solution to this is to get the height and width of the image you wish to load and make them attributes (or a style) on the image tag itself. Yes it's terrible to have inline styles, but it's&nbsp;necessary&nbsp;in this case.</p>
<p>One of the challenges of Advanced Custom Fields Gallery plugin is that it doesn't use wordpress attachments for images, so you can't just call for the width and height using&nbsp;<a href="http://codex.wordpress.org/Function_Reference/wp_get_attachment_image_src" target="_blank">wp_get_attachment_image_src</a><span>. &nbsp;Even just asking ACF to retrieve the size doesn't work because we aren't using the original image, but one of the crops that wordpress automatically creates (in this case a custom size added with "<a href="http://codex.wordpress.org/Function_Reference/add_image_size" target="_blank">add_image_size</a>"). &nbsp;ACF was consistently returning the size of the original image and not of the custom thumbnail size I had created.&nbsp;</span></p>
<p>The solution to this was to use php getimagesize() to return the proper values of the specific image size I was looking for.&nbsp;</p>
<p>Once the placeholder image has been given the size of the image you are loading -- it successfully <em>holds the place (har har)</em> of the not yet loaded image. And <strong>ta-dah!</strong> you have a&nbsp;beautiful&nbsp;lazy loaded masonry style gallery.</p>
<p>Maybe you already knew how to do this, but maybe this will also help someone who didn't know how to do it and this will save them many hours.</p>
<p>See final code below (sorry - don't know of a good way to display code you can copy/paste in Tumblr)</p>
<p><img alt="image" src="http://media.tumblr.com/9156a2f43442eaf91eb54e19504991c0/tumblr_inline_mo7ar5TGRP1qz4rgp.png" /></p>
<p></p>
